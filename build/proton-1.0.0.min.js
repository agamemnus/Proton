/*!
 * Proton v1.0.0
 * https://github.com/a-jie/Proton
 *
 * Copyright 2011-2013, A-JIE
 * Licensed under the MIT license
 * http://www.opensource.org/licenses/mit-license
 *
 */
!function(e,t){function n(e,t){this.proParticleCount=n.Util.initValue(e,n.POOL_MAX);this.integrationType=n.Util.initValue(t,n.EULER);this.emitters=[];this.renderers=[];this.time=0;this.oldTime=0;n.pool=new n.ParticlePool(this.proParticleCount);n.integrator=new n.NumericalIntegration(this.integrationType)}function r(){this.initialize()}function s(e){this.type=e["type"];this.particle=e["particle"];this.emitter=e["emitter"]}function f(){this.mats=[];this.size=0;for(var e=0;e<20;e++)this.mats.push(n.Mat3.create([0,0,0,0,0,0,0,0,0]))}function l(e){this.id="particle_"+l.ID++;this.reset(true);n.Util.setPrototypeByObject(this,e)}function c(e,t){this.proParticleCount=n.Util.initValue(e,0);this.releaseTime=n.Util.initValue(t,-1);this.poolList=[];this.timeoutID=0;for(var r=0;r<this.proParticleCount;r++){this.add()}if(this.releaseTime>0)this.timeoutID=setTimeout(this.release,this.releaseTime/1e3)}function m(e,t,r){this.isArray=false;if(n.Util.isArray(e)){this.isArray=true;this.a=e}else{this.a=n.Util.initValue(e,1);this.b=n.Util.initValue(t,this.a);this.center=n.Util.initValue(r,false)}}function g(e){if(n.Util.isArray(e)){this.colorArr=e}else{this.colorArr=[e]}}function y(e,t,n,r){this.x=e;this.y=t;this.width=n;this.height=r;this.bottom=this.y+this.height;this.right=this.x+this.width}function w(e,t){this.id="Behavior_"+w.id++;this.life=n.Util.initValue(e,Infinity);this.easing=n.ease.setEasingByName(t);this.age=0;this.energy=1;this.dead=false;this.parents=[];this.name="Behavior"}function E(e,t){this.numPan=n.Util.initValue(e,1);this.timePan=n.Util.initValue(t,1);this.numPan=n.Util.setSpanValue(this.numPan);this.timePan=n.Util.setSpanValue(this.timePan);this.startTime=0;this.nextTime=0;this.init()}function S(){}function T(e,t,r){T._super_.call(this);this.lifePan=n.Util.setSpanValue(e,t,r)}function N(e){N._super_.call(this);this.zone=n.Util.initValue(e,new n.PointZone)}function C(e,t,r){C._super_.call(this);this.rPan=n.Util.setSpanValue(e);this.thaPan=n.Util.setSpanValue(t);this.type=n.Util.initValue(r,"vector")}function k(e,t,r){k._super_.call(this);this.massPan=n.Util.setSpanValue(e,t,r)}function L(e,t,r){L._super_.call(this);this.radius=n.Util.setSpanValue(e,t,r)}function A(e,t,r){A._super_.call(this);this.image=this.setSpanValue(e);this.w=n.Util.initValue(t,20);this.h=n.Util.initValue(r,this.w)}function O(e,t,r,i){O._super_.call(this,r,i);this.force=this.normalizeForce(new n.Vector2D(e,t));this.name="Force"}function M(e,t,r,i,s){M._super_.call(this,i,s);this.targetPosition=n.Util.initValue(e,new n.Vector2D);this.radius=n.Util.initValue(r,1e3);this.force=n.Util.initValue(this.normalizeValue(t),100);this.radiusSq=this.radius*this.radius;this.attractionForce=new n.Vector2D;this.lengthSq=0;this.name="Attraction"}function _(e,t,n,r,i){_._super_.call(this,r,i);this.reset(e,t,n);this.time=0;this.name="RandomDrift"}function D(e,t,n,r,i){D._super_.call(this,e,t,n,r,i);this.force*=-1;this.name="Repulsion"}function P(e,t,n){P._super_.call(this,0,e,t,n);this.name="Gravity"}function H(e,t,n,r,i){H._super_.call(this,r,i);this.reset(e,t,n);this.name="Collision"}function B(e,t,n,r){B._super_.call(this,n,r);this.reset(e,t);this.name="CrossZone"}function j(e,t,n,r){j._super_.call(this,n,r);this.reset(e,t);this.name="Alpha"}function F(e,t,n,r){F._super_.call(this,n,r);this.reset(e,t);this.name="Scale"}function I(e,t,n,r,i){I._super_.call(this,r,i);this.reset(e,t,n);this.name="Rotate"}function q(e,t,n,r){q._super_.call(this,n,r);this.reset(e,t);this.name="Color"}function R(e,t,r,i){R._super_.call(this,r,i);this.distanceVec=new n.Vector2D;this.centerPoint=n.Util.initValue(e,new n.Vector2D);this.force=n.Util.initValue(this.normalizeValue(t),100);this.name="GravityWell"}function U(e){this.initializes=[];this.particles=[];this.behaviors=[];this.emitTime=0;this.emitTotalTimes=-1;this.damping=.006;this.bindEmitter=true;this.rate=new n.Rate(1,.1);U._super_.call(this,e);this.id="emitter_"+U.ID++}function z(e){this.selfBehaviors=[];z._super_.call(this,e)}function W(t,r,i){this.mouseTarget=n.Util.initValue(t,e);this.ease=n.Util.initValue(r,.7);this._allowEmitting=false;this.initEventHandler();W._super_.call(this,i)}function V(e,t,r){this.element=r;this.type=n.Util.initValue(e,"canvas");this.proton=t;this.renderer=this.getRenderer()}function $(e,t,n){this.proton=e;this.element=t;this.stroke=n}function J(e,t){J._super_.call(this,e,t);this.stroke=null}function K(e,t,n){K._super_.call(this,e,t);this.stroke=n}function Q(e,t){Q._super_.call(this,e,t);this.stroke=null;this.context=this.element.getContext("2d");this.bufferCache={}}function G(e,t,n){G._super_.call(this,e,t);this.context=this.element.getContext("2d");this.imageData=null;this.rectangle=null;this.rectangle=n;this.createImageData(n)}function Y(e,t){Y._super_.call(this,e,t);this.gl=this.element.getContext("experimental-webgl",{antialias:true,stencil:false,depth:false});if(!this.gl)alert("Sorry your browser do not suppest WebGL!");this.initVar();this.setMaxRadius();this.initShaders();this.initBuffers();this.gl.blendEquation(this.gl.FUNC_ADD);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.gl.enable(this.gl.BLEND)}function Z(){this.vector=new n.Vector2D(0,0);this.random=0;this.crossType="dead";this.alert=true}function et(e,t,r,i,s){et._super_.call(this);if(r-e>=0){this.x1=e;this.y1=t;this.x2=r;this.y2=i}else{this.x1=r;this.y1=i;this.x2=e;this.y2=t}this.dx=this.x2-this.x1;this.dy=this.y2-this.y1;this.minx=Math.min(this.x1,this.x2);this.miny=Math.min(this.y1,this.y2);this.maxx=Math.max(this.x1,this.x2);this.maxy=Math.max(this.y1,this.y2);this.dot=this.x2*this.y1-this.x1*this.y2;this.xxyy=this.dx*this.dx+this.dy*this.dy;this.gradient=this.getGradient();this.length=this.getLength();this.direction=n.Util.initValue(s,">")}function tt(e,t,n){tt._super_.call(this);this.x=e;this.y=t;this.radius=n;this.angle=0;this.center={x:this.x,y:this.y}}function nt(e,t){nt._super_.call(this);this.x=e;this.y=t}function rt(e,t,n,r){rt._super_.call(this);this.x=e;this.y=t;this.width=n;this.height=r}function it(e,t,n,r){it._super_.call(this);this.reset(e,t,n,r)}n.POOL_MAX=1e3;n.TIME_STEP=60;n.MEASURE=100;n.EULER="euler";n.RK2="runge-kutta2";n.RK4="runge-kutta4";n.VERLET="verlet";n.PARTICLE_CREATED="partilcleCreated";n.PARTICLE_UPDATE="partilcleUpdate";n.PARTICLE_SLEEP="particleSleep";n.PARTICLE_DEAD="partilcleDead";n.PROTON_UPDATE="protonUpdate";n.PROTON_UPDATE_AFTER="protonUpdateAfter";n.EMITTER_ADDED="emitterAdded";n.EMITTER_REMOVED="emitterRemoved";n.amendChangeTabsBug=true;n.TextureBuffer={};n.TextureCanvasBuffer={};n.prototype={addRender:function(e){e.proton=this;this.renderers.push(e.proton)},addEmitter:function(e){this.emitters.push(e);e.parent=this;this.dispatchEvent(new n.Event({type:n.EMITTER_ADDED,emitter:e}))},removeEmitter:function(e){var t=this.emitters.indexOf(e);this.emitters.splice(t,1);e.parent=null;this.dispatchEvent(new n.Event({type:n.EMITTER_REMOVED,emitter:e}))},update:function(){this.dispatchEvent(new n.Event({type:n.PROTON_UPDATE}));if(!this.oldTime)this.oldTime=(new Date).getTime();var e=(new Date).getTime();this.elapsed=(e-this.oldTime)/1e3;if(n.amendChangeTabsBug)this.amendChangeTabsBug();this.oldTime=e;if(this.elapsed>0){for(var t=0;t<this.emitters.length;t++){if(this.emitters[t])this.emitters[t].update(this.elapsed)}}this.dispatchEvent(new n.Event({type:n.PROTON_UPDATE_AFTER}))},amendChangeTabsBug:function(){if(this.elapsed>.5){this.oldTime=(new Date).getTime();this.elapsed=0}},getCount:function(){var e=0;var t=this.emitters.length;for(var n=0;n<t;n++){e+=this.emitters[n].particles.length}return e},destroy:function(){var e=this.emitters.length;for(var t=0;t<e;t++){if(these.emitters[t]){this.emitters[t].destroy();delete this.emitters[t]}}this.emitters=[];this.time=0;this.oldTime=0;n.pool.release()}};e.Proton=n;var i=r.prototype;r.initialize=function(e){e.addEventListener=i.addEventListener;e.removeEventListener=i.removeEventListener;e.removeAllEventListeners=i.removeAllEventListeners;e.hasEventListener=i.hasEventListener;e.dispatchEvent=i.dispatchEvent};i._listeners=null;i.initialize=function(){};i.addEventListener=function(e,t){var n=this._listeners;if(!n){n=this._listeners={}}else{this.removeEventListener(e,t)}var r=n[e];if(!r){r=n[e]=[]}r.push(t);return t};i.removeEventListener=function(e,t){var n=this._listeners;if(!n){return}var r=n[e];if(!r){return}for(var i=0,s=r.length;i<s;i++){if(r[i]==t){if(s==1){delete n[e]}else{r.splice(i,1)}break}}};i.removeAllEventListeners=function(e){if(!e){this._listeners=null}else if(this._listeners){delete this._listeners[e]}};i.dispatchEvent=function(e){var t=false,n=this._listeners;if(e&&n){var r=n[e.type];if(!r)return t;r=r.slice();for(var i=0,s=r.length;i<s;i++){var o=r[i];t=t||o(e)}}return!!t};i.hasEventListener=function(e){var t=this._listeners;return!!(t&&t[e])};n.EventDispatcher=r;n.EventDispatcher.initialize(n.prototype);n.Event=s;var o=o||{initValue:function(e,n){var e=e!=null&&e!=t?e:n;return e},isArray:function(e){return typeof e==="object"&&e.hasOwnProperty("length")},destroyArray:function(e){e.length=0},destroyObject:function(e){for(var t in e)delete e[t]},getVector2D:function(e,t){if(typeof e=="object"){return e}else{var r=new n.Vector2D(e,t);return r}},judgeVector2D:function(e){var t="";if(e.hasOwnProperty("x")||e.hasOwnProperty("y")||e.hasOwnProperty("p")||e.hasOwnProperty("position"))t+="p";if(e.hasOwnProperty("vx")||e.hasOwnProperty("vx")||e.hasOwnProperty("v")||e.hasOwnProperty("velocity"))t+="v";if(e.hasOwnProperty("ax")||e.hasOwnProperty("ax")||e.hasOwnProperty("a")||e.hasOwnProperty("accelerate"))t+="a";return t},setVector2DByObject:function(e,t){if(t.hasOwnProperty("x"))e.p.x=t["x"];if(t.hasOwnProperty("y"))e.p.y=t["y"];if(t.hasOwnProperty("vx"))e.v.x=t["vx"];if(t.hasOwnProperty("vy"))e.v.y=t["vy"];if(t.hasOwnProperty("ax"))e.a.x=t["ax"];if(t.hasOwnProperty("ay"))e.a.y=t["ay"];if(t.hasOwnProperty("p"))particle.p.copy(t["p"]);if(t.hasOwnProperty("v"))particle.v.copy(t["v"]);if(t.hasOwnProperty("a"))particle.a.copy(t["a"]);if(t.hasOwnProperty("position"))particle.p.copy(t["position"]);if(t.hasOwnProperty("velocity"))particle.v.copy(t["velocity"]);if(t.hasOwnProperty("accelerate"))particle.a.copy(t["accelerate"])},addPrototypeByObject:function(e,t,r){for(var i in t){if(r){if(r.indexOf(i)<0)e[i]=n.Util.getSpanValue(t[i])}else{e[i]=n.Util.getSpanValue(t[i])}}return e},setPrototypeByObject:function(e,t,r){for(var i in t){if(e.hasOwnProperty(i)){if(r){if(r.indexOf(i)<0)e[i]=n.Util.getSpanValue(t[i])}else{e[i]=n.Util.getSpanValue(t[i])}}}return e},setSpanValue:function(e,t,r){if(e instanceof n.Span){return e}else{if(!t){return new n.Span(e)}else{if(!r)return new n.Span(e,t);else return new n.Span(e,t,r)}}},getSpanValue:function(e){if(e instanceof n.Span)return e.getValue();else return e},inherits:function(e,t){e._super_=t;if(Object["create"]){e.prototype=Object.create(t.prototype,{constructor:{value:t}})}else{var n=function(){};n.prototype=t.prototype;e.prototype=new n;e.prototype.constructor=e}},getImageData:function(e,t,n){e.drawImage(t,n.x,n.y);var r=e.getImageData(n.x,n.y,n.width,n.height);e.clearRect(n.x,n.y,n.width,n.height);return r},getImage:function(e,t,n,r){if(typeof e=="string"){this.loadAndSetImage(e,t,n,r)}else if(typeof e=="object"){this.loadAndSetImage(e.src,t,n,r)}else if(e instanceof Image){this.loadedImage(e.src,t,n,r,e)}},loadedImage:function(e,t,r,i,s){t.target=s;t.transform.src=e;if(!n.TextureBuffer[e])n.TextureBuffer[e]=t.target;if(r){if(n.TextureCanvasBuffer[e]){t.transform.canvas=n.TextureCanvasBuffer[e]}else{var o=n.WebGLUtil.nhpot(t.target.width);var u=n.WebGLUtil.nhpot(t.target.height);t.transform.canvas=n.DomUtil.createCanvas("canvas"+e,o,u);var a=t.transform.canvas.getContext("2d");a.drawImage(t.target,0,0,t.target.width,t.target.height);n.TextureCanvasBuffer[e]=t.transform.canvas}}if(i)i(t)},loadAndSetImage:function(e,t,r,i){if(n.TextureBuffer[e]){this.loadedImage(e,t,r,i,n.TextureBuffer[e])}else{var s=this;var o=new Image;o.onload=function(n){s.loadedImage(e,t,r,i,n.target)};o.src=e}},hexToRGB:function(e){var t=e.charAt(0)=="#"?e.substring(1,7):e;var n=parseInt(t.substring(0,2),16);var r=parseInt(t.substring(2,4),16);var i=parseInt(t.substring(4,6),16);return{r:n,g:r,b:i}},rgbToHex:function(e){return"rgb("+e.r+", "+e.g+", "+e.b+")"}};n.Util=o;var u=u||{ipot:function(e){return(e&e-1)==0},nhpot:function(e){--e;for(var t=1;t<32;t<<=1){e=e|e>>t}return e+1},makeTranslation:function(e,t){return[1,0,0,0,1,0,e,t,1]},makeRotation:function(e){var t=Math.cos(e);var n=Math.sin(e);return[t,-n,0,n,t,0,0,0,1]},makeScale:function(e,t){return[e,0,0,0,t,0,0,0,1]},matrixMultiply:function(e,t){var n=e[0*3+0];var r=e[0*3+1];var i=e[0*3+2];var s=e[1*3+0];var o=e[1*3+1];var u=e[1*3+2];var a=e[2*3+0];var f=e[2*3+1];var l=e[2*3+2];var c=t[0*3+0];var h=t[0*3+1];var p=t[0*3+2];var d=t[1*3+0];var v=t[1*3+1];var m=t[1*3+2];var g=t[2*3+0];var y=t[2*3+1];var b=t[2*3+2];return[n*c+r*d+i*g,n*h+r*v+i*y,n*p+r*m+i*b,s*c+o*d+u*g,s*h+o*v+u*y,s*p+o*m+u*b,a*c+f*d+l*g,a*h+f*v+l*y,a*p+f*m+l*b]}};n.WebGLUtil=u;var a=a||{createCanvas:function(e,t,n,r){var i=document.createElement("canvas");var s=r?r:"absolute";i.id=e;i.width=t;i.height=n;i.style.position=s;i.style.opacity=0;this.transformDom(i,-500,-500,0,0);return i},transformDom:function(e,t,n,r,i){e.style.WebkitTransform="translate("+t+"px, "+n+"px) "+"scale("+r+") "+"rotate("+i+"deg)";e.style.MozTransform="translate("+t+"px, "+n+"px) "+"scale("+r+") "+"rotate("+i+"deg)";e.style.OTransform="translate("+t+"px, "+n+"px) "+"scale("+r+") "+"rotate("+i+"deg)";e.style.msTransform="translate("+t+"px, "+n+"px) "+"scale("+r+") "+"rotate("+i+"deg)";e.style.transform="translate("+t+"px, "+n+"px) "+"scale("+r+") "+"rotate("+i+"deg)"}};n.DomUtil=a;f.prototype.set=function(e,t){if(t==0)n.Mat3.set(e,this.mats[0]);else n.Mat3.multiply(this.mats[t-1],e,this.mats[t]);this.size=Math.max(this.size,t+1)};f.prototype.push=function(e){if(this.size==0)n.Mat3.set(e,this.mats[0]);else n.Mat3.multiply(this.mats[this.size-1],e,this.mats[this.size]);this.size++};f.prototype.pop=function(){if(this.size>0)this.size--};f.prototype.top=function(){return this.mats[this.size-1]};n.MStack=f;l.ID=0;l.prototype={getDirection:function(){return Math.atan2(this.v.x,-this.v.y)*(180/Math.PI)},reset:function(e){this.life=Infinity;this.age=0;this.energy=1;this.dead=false;this.sleep=false;this.target=null;this.sprite=null;this.parent=null;this.mass=1;this.radius=10;this.alpha=1;this.scale=1;this.rotation=0;this.color=null;this.easing=n.ease.setEasingByName(n.easeLinear);if(e){this.transform={};this.p=new n.Vector2D;this.v=new n.Vector2D;this.a=new n.Vector2D;this.old={p:new n.Vector2D,v:new n.Vector2D,a:new n.Vector2D};this.behaviors=[]}else{n.Util.destroyObject(this.transform);this.p.set(0,0);this.v.set(0,0);this.a.set(0,0);this.old.p.set(0,0);this.old.v.set(0,0);this.old.a.set(0,0);this.removeAllBehaviors()}this.transform.rgb={r:255,g:255,b:255};return this},update:function(e,t){if(!this.sleep){this.age+=e;var n=this.behaviors.length,r;for(r=0;r<n;r++){if(this.behaviors[r])this.behaviors[r].applyBehavior(this,e,t)}}else{}if(this.age>=this.life){this.destroy()}else{var i=this.easing(this.age/this.life);this.energy=Math.max(1-i,0)}},addBehavior:function(e){this.behaviors.push(e);if(e.hasOwnProperty("parents"))e.parents.push(this);e.initialize(this)},addBehaviors:function(e){var t=e.length,n;for(n=0;n<t;n++){this.addBehavior(e[n])}},removeBehavior:function(e){var t=this.behaviors.indexOf(e);if(t>-1){var e=this.behaviors.splice(t,1);e.parents=null}},removeAllBehaviors:function(){n.Util.destroyArray(this.behaviors)},destroy:function(){this.removeAllBehaviors();this.energy=0;this.dead=true;this.parent=null}};n.Particle=l;c.prototype={create:function(e){if(e)return new newTypeParticle;else return new n.Particle},getCount:function(){return this.poolList.length},add:function(){return this.poolList.push(this.create())},get:function(){if(this.poolList.length===0){return this.create()}else{return this.poolList.pop().reset()}},set:function(e){if(this.poolList.length<n.POOL_MAX)return this.poolList.push(e)},release:function(){for(var e=0;e<this.poolList.length;e++){if(this.poolList[e]["destroy"])this.poolList[e].destroy();delete this.poolList[e]}this.poolList=[]}};n.ParticlePool=c;var h={randomAToB:function(e,t,n){if(!n)return e+Math.random()*(t-e);else return Math.floor(Math.random()*(t-e))+e},randomFloating:function(e,t,n){return h.randomAToB(e-t,e+t,n)},randomZone:function(e){},degreeTransform:function(e){return e*Math.PI/180},toColor16:function(t){return"#"+t.toString(16)},randomColor:function(){return"#"+("00000"+(Math.random()*16777216<<0).toString(16)).slice(-6)}};n.MathUtils=h;var p=function(e){this.type=n.Util.initValue(e,n.EULER)};p.prototype={integrate:function(e,t,n){this.eulerIntegrate(e,t,n)},eulerIntegrate:function(e,t,n){if(!e.sleep){e.old.p.copy(e.p);e.old.v.copy(e.v);e.a.multiplyScalar(1/e.mass);e.v.add(e.a.multiplyScalar(t));e.p.add(e.old.v.multiplyScalar(t));if(n)e.v.multiplyScalar(n);e.a.clear()}}};n.NumericalIntegration=p;var d=function(e,t){this.x=e||0;this.y=t||0};d.prototype={set:function(e,t){this.x=e;this.y=t;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getGradient:function(){if(this.x!=0)return Math.atan2(this.y,this.x);else if(this.y>0)return Math.PI/2;else if(this.y<0)return-Math.PI/2},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;return this},add:function(e,n){if(n!==t){return this.addVectors(e,n)}this.x+=e.x;this.y+=e.y;return this},addXY:function(e,t){this.x+=e;this.y+=t;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this},addScalar:function(e){this.x+=e;this.y+=e;return this},sub:function(e,n){if(n!==t){return this.subVectors(e,n)}this.x-=e.x;this.y-=e.y;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;return this},divideScalar:function(e){if(e!==0){this.x/=e;this.y/=e}else{this.set(0,0)}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},rotate:function(e){var t=this.x;var n=this.y;this.x=t*Math.cos(e)+n*Math.sin(e);this.y=-t*Math.sin(e)+n*Math.cos(e);return this},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this},equals:function(e){return e.x===this.x&&e.y===this.y},toArray:function(){return[this.x,this.y]},clear:function(){this.x=0;this.y=0;return this},clone:function(){return new n.Vector2D(this.x,this.y)}};n.Vector2D=d;var v=function(e,t){this.r=Math.abs(e)||0;this.tha=t||0};v.prototype={set:function(e,t){this.r=e;this.tha=t;return this},setR:function(e){this.r=e;return this},setTha:function(e){this.tha=e;return this},copy:function(e){this.r=e.r;this.tha=e.tha;return this},toVector:function(){return new n.Vector2D(this.getX(),this.getY())},getX:function(){return this.r*Math.sin(this.tha)},getY:function(){return-this.r*Math.cos(this.tha)},normalize:function(){this.r=1;return this},equals:function(e){return e.r===this.r&&e.tha===this.tha},toArray:function(){return[this.r,this.tha]},clear:function(){this.r=0;this.tha=0;return this},clone:function(){return new n.Polar2D(this.r,this.tha)}};n.Polar2D=v;m.prototype={getValue:function(e){if(this.isArray){return this.a[Math.floor(this.a.length*Math.random())]}else{if(!this.center)return n.MathUtils.randomAToB(this.a,this.b,e);else return n.MathUtils.randomFloating(this.a,this.b,e)}}};n.Span=m;n.getSpan=function(e,t,r){return new n.Span(e,t,r)};n.Util.inherits(g,n.Span);g.prototype.getValue=function(){var e=this.colorArr[Math.floor(this.colorArr.length*Math.random())];if(e=="random"||e=="Random")return n.MathUtils.randomColor();else return e};n.ColorSpan=g;y.prototype={contains:function(e,t){if(e<=this.right&&e>=this.x&&t<=this.bottom&&t>=this.y)return true;else return false}};n.Rectangle=y;var b=b||{create:function(e){var t=new Float32Array(9);if(e)this.set(e,t);return t},set:function(e,t){for(var n=0;n<9;n++)t[n]=e[n];return t},multiply:function(e,t,n){var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[6],f=e[7],l=t[0],c=t[1],h=t[2],p=t[3],d=t[4],v=t[6],m=t[7];n[0]=l*r+c*o;n[1]=l*i+c*u;n[2]=s*h;n[3]=p*r+d*o;n[4]=p*i+d*u;n[6]=v*r+m*o+a;n[7]=v*i+m*u+f;return n},inverse:function(e,t){var n=e[0],r=e[1],i=e[3],s=e[4],o=e[6],u=e[7],a=s,f=-i,l=u*i-s*o,c=n*a+r*f,h;h=1/c;t[0]=a*h;t[1]=-r*h;t[3]=f*h;t[4]=n*h;t[6]=l*h;t[7]=(-u*n+r*o)*h;return t},multiplyVec2:function(e,t,n){var r=t[0],i=t[1];n[0]=r*e[0]+i*e[3]+e[6];n[1]=r*e[1]+i*e[4]+e[7];return n}};n.Mat3=b;w.id=0;w.prototype={reset:function(e,t){this.life=n.Util.initValue(e,Infinity);this.easing=n.Util.initValue(t,n.ease.setEasingByName(n.easeLinear))},normalizeForce:function(e){return e.multiplyScalar(n.MEASURE)},normalizeValue:function(e){return e*n.MEASURE},initialize:function(e){},applyBehavior:function(e,t,n){this.age+=t;if(this.age>=this.life||this.dead){this.energy=0;this.dead=true;this.destroy()}else{var r=this.easing(e.age/e.life);this.energy=Math.max(1-r,0)}},destroy:function(){var e;var t=this.parents.length,n;for(n=0;n<t;n++){this.parents[n].removeBehavior(this)}this.parents=[]}};n.Behavior=w;E.prototype={init:function(){this.startTime=0;this.nextTime=this.timePan.getValue()},getValue:function(e){this.startTime+=e;if(this.startTime>=this.nextTime){this.startTime=0;this.nextTime=this.timePan.getValue();if(this.numPan.b==1){if(this.numPan.getValue(false)>.5)return 1;else return 0}else{return this.numPan.getValue(true)}}return 0}};n.Rate=E;S.prototype.reset=function(){};S.prototype.init=function(e,t){if(t){this.initialize(t)}else{this.initialize(e)}};S.prototype.initialize=function(e){};n.Initialize=S;var x={initialize:function(e,t,r){var i=r.length,s;for(s=0;s<i;s++){if(r[s]instanceof n.Initialize)r[s].init(e,t);else n.InitializeUtil.init(e,t,r[s])}n.InitializeUtil.bindEmitter(e,t)},init:function(e,t,r){n.Util.setPrototypeByObject(t,r);n.Util.setVector2DByObject(t,r)},bindEmitter:function(e,t){if(e.bindEmitter){t.p.add(e.p);t.v.add(e.v);t.a.add(e.a);t.v.rotate(n.MathUtils.degreeTransform(e.rotation))}}};n.InitializeUtil=x;n.Util.inherits(T,n.Initialize);T.prototype.initialize=function(e){if(this.lifePan.a==Infinity)e.life=Infinity;else e.life=this.lifePan.getValue()};n.Life=T;n.Util.inherits(N,n.Initialize);N.prototype.reset=function(e){this.zone=n.Util.initValue(e,new n.PointZone)};N.prototype.initialize=function(e){this.zone.getPosition();e.p.x=this.zone.vector.x;e.p.y=this.zone.vector.y};n.Position=N;n.P=N;n.Util.inherits(C,n.Initialize);C.prototype.reset=function(e,t,r){this.rPan=n.Util.setSpanValue(e);this.thaPan=n.Util.setSpanValue(t);this.type=n.Util.initValue(r,"vector")};C.prototype.normalizeVelocity=function(e){return e*n.MEASURE};C.prototype.initialize=function(e){if(this.type=="p"||this.type=="P"||this.type=="polar"){var t=new n.Polar2D(this.normalizeVelocity(this.rPan.getValue()),this.thaPan.getValue()*Math.PI/180);e.v.x=t.getX();e.v.y=t.getY()}else{e.v.x=this.normalizeVelocity(this.rPan.getValue());e.v.y=this.normalizeVelocity(this.thaPan.getValue())}};n.Velocity=C;n.V=C;n.Util.inherits(k,n.Initialize);k.prototype.initialize=function(e){e.mass=this.massPan.getValue()};n.Mass=k;n.Util.inherits(L,n.Initialize);L.prototype.reset=function(e,t,r){this.radius=n.Util.setSpanValue(e,t,r)};L.prototype.initialize=function(e){e.radius=this.radius.getValue();e.transform.oldRadius=e.radius};n.Radius=L;n.Util.inherits(A,n.Initialize);A.prototype.initialize=function(e){var t=this.image.getValue();if(typeof t=="string"){e.target={width:this.w,height:this.h,src:t}}else{e.target=t}};A.prototype.setSpanValue=function(e){if(e instanceof n.ColorSpan){return e}else{return new n.ColorSpan(e)}};n.ImageTarget=A;n.Util.inherits(O,n.Behavior);O.prototype.reset=function(e,t,r,i){this.force=this.normalizeForce(new n.Vector2D(e,t));if(r)O._super_.prototype.reset.call(this,r,i)};O.prototype.applyBehavior=function(e,t,n){O._super_.prototype.applyBehavior.call(this,e,t,n);e.a.add(this.force)};n.Force=O;n.F=O;n.Util.inherits(M,n.Behavior);M.prototype.reset=function(e,t,r,i,s){this.targetPosition=n.Util.initValue(e,new n.Vector2D);this.radius=n.Util.initValue(r,1e3);this.force=n.Util.initValue(this.normalizeValue(t),100);this.radiusSq=this.radius*this.radius;this.attractionForce=new n.Vector2D;this.lengthSq=0;if(i)M._super_.prototype.reset.call(this,i,s)};M.prototype.applyBehavior=function(e,t,n){M._super_.prototype.applyBehavior.call(this,e,t,n);this.attractionForce.copy(this.targetPosition);this.attractionForce.sub(e.p);this.lengthSq=this.attractionForce.lengthSq();if(this.lengthSq>4e-6&&this.lengthSq<this.radiusSq){this.attractionForce.normalize();this.attractionForce.multiplyScalar(1-this.lengthSq/this.radiusSq);this.attractionForce.multiplyScalar(this.force);e.a.add(this.attractionForce)}};n.Attraction=M;n.Util.inherits(_,n.Behavior);_.prototype.reset=function(e,t,r,i,s){this.panFoce=new n.Vector2D(e,t);this.panFoce=this.normalizeForce(this.panFoce);this.delay=r;if(i)_._super_.prototype.reset.call(this,i,s)};_.prototype.applyBehavior=function(e,t,r){_._super_.prototype.applyBehavior.call(this,e,t,r);this.time+=t;if(this.time>=this.delay){e.a.addXY(n.MathUtils.randomAToB(-this.panFoce.x,this.panFoce.x),n.MathUtils.randomAToB(-this.panFoce.y,this.panFoce.y));this.time=0}};n.RandomDrift=_;n.Util.inherits(D,n.Attraction);D.prototype.reset=function(e,t,n,r,i){D._super_.prototype.reset.call(this,e,t,n,r,i);this.force*=-1};n.Repulsion=D;n.Util.inherits(P,n.Force);P.prototype.reset=function(e,t,n){P._super_.prototype.reset.call(this,0,e,t,n)};n.Gravity=P;n.G=P;n.Util.inherits(H,n.Behavior);H.prototype.reset=function(e,t,r,i,s){this.emitter=n.Util.initValue(e,null);this.mass=n.Util.initValue(t,true);this.callback=n.Util.initValue(r,null);this.collisionPool=[];this.delta=new n.Vector2D;if(i)H._super_.prototype.reset.call(this,i,s)};H.prototype.applyBehavior=function(e,t,n){var r=this.emitter?this.emitter.particles.slice(n):this.pool.slice(n);var i;var s;var o;var u,a;var f=r.length;for(var l=0;l<f;l++){i=r[l];if(i!==e){this.delta.copy(i.p);this.delta.sub(e.p);s=this.delta.lengthSq();distance=e.radius+i.radius;if(s<=distance*distance){o=distance-Math.sqrt(s);o+=.5;totalMass=e.mass+i.mass;u=this.mass?i.mass/totalMass:.5;a=this.mass?e.mass/totalMass:.5;e.p.add(this.delta.clone().normalize().multiplyScalar(o*-u));i.p.add(this.delta.normalize().multiplyScalar(o*a));if(this.callback)this.callback(e,i)}}}};n.Collision=H;n.Util.inherits(B,n.Behavior);B.prototype.reset=function(e,t,r,i){this.zone=e;this.zone.crossType=n.Util.initValue(t,"dead");if(r)B._super_.prototype.reset.call(this,r,i)};B.prototype.applyBehavior=function(e,t,n){B._super_.prototype.applyBehavior.call(this,e,t,n);this.zone.crossing(e)};n.CrossZone=B;n.Util.inherits(j,n.Behavior);j.prototype.reset=function(e,r,i,s){if(r==null||r==t)this.same=true;else this.same=false;this.a=n.Util.setSpanValue(n.Util.initValue(e,1));this.b=n.Util.setSpanValue(r);if(i)j._super_.prototype.reset.call(this,i,s)};j.prototype.initialize=function(e){e.transform.alphaA=this.a.getValue();if(this.same)e.transform.alphaB=e.transform.alphaA;else e.transform.alphaB=this.b.getValue()};j.prototype.applyBehavior=function(e,t,n){j._super_.prototype.applyBehavior.call(this,e,t,n);e.alpha=e.transform.alphaB+(e.transform.alphaA-e.transform.alphaB)*this.energy;if(e.alpha<.001)e.alpha=0};n.Alpha=j;n.Util.inherits(F,n.Behavior);F.prototype.reset=function(e,r,i,s){if(r==null||r==t)this.same=true;else this.same=false;this.a=n.Util.setSpanValue(n.Util.initValue(e,1));this.b=n.Util.setSpanValue(r);if(i)F._super_.prototype.reset.call(this,i,s)};F.prototype.initialize=function(e){e.transform.scaleA=this.a.getValue();e.transform.oldRadius=e.radius;if(this.same)e.transform.scaleB=e.transform.scaleA;else e.transform.scaleB=this.b.getValue()};F.prototype.applyBehavior=function(e,t,n){F._super_.prototype.applyBehavior.call(this,e,t,n);e.scale=e.transform.scaleB+(e.transform.scaleA-e.transform.scaleB)*this.energy;if(e.scale<1e-4)e.scale=0;e.radius=e.transform.oldRadius*e.scale};n.Scale=F;n.Util.inherits(I,n.Behavior);I.prototype.reset=function(e,r,i,s,o){if(r==null||r==t)this.same=true;else this.same=false;this.a=n.Util.setSpanValue(n.Util.initValue(e,"Velocity"));this.b=n.Util.setSpanValue(n.Util.initValue(r,0));this.style=n.Util.initValue(i,"to");if(s)I._super_.prototype.reset.call(this,s,o)};I.prototype.initialize=function(e){e.rotation=this.a.getValue();e.transform.rotationA=this.a.getValue();if(!this.same)e.transform.rotationB=this.b.getValue()};I.prototype.applyBehavior=function(e,t,n){I._super_.prototype.applyBehavior.call(this,e,t,n);if(!this.same){if(this.style=="to"||this.style=="TO"||this.style=="_"){e.rotation+=e.transform.rotationB+(e.transform.rotationA-e.transform.rotationB)*this.energy}else{e.rotation+=e.transform.rotationB}}else if(this.a.a=="V"||this.a.a=="Velocity"||this.a.a=="v"){e.rotation=e.getDirection()}};n.Rotate=I;n.Util.inherits(q,n.Behavior);q.prototype.reset=function(e,t,n,r){this.color1=this.setSpanValue(e);this.color2=this.setSpanValue(t);if(n)q._super_.prototype.reset.call(this,n,r)};q.prototype.initialize=function(e){e.color=this.color1.getValue();e.transform.beginRGB=n.Util.hexToRGB(e.color);if(this.color2)e.transform.endRGB=n.Util.hexToRGB(this.color2.getValue())};q.prototype.applyBehavior=function(e,t,n){if(this.color2){q._super_.prototype.applyBehavior.call(this,e,t,n);e.transform.rgb.r=e.transform.endRGB.r+(e.transform.beginRGB.r-e.transform.endRGB.r)*this.energy;e.transform.rgb.g=e.transform.endRGB.g+(e.transform.beginRGB.g-e.transform.endRGB.g)*this.energy;e.transform.rgb.b=e.transform.endRGB.b+(e.transform.beginRGB.b-e.transform.endRGB.b)*this.energy;e.transform.rgb.r=parseInt(e.transform.rgb.r,10);e.transform.rgb.g=parseInt(e.transform.rgb.g,10);e.transform.rgb.b=parseInt(e.transform.rgb.b,10)}else{e.transform.rgb.r=e.transform.beginRGB.r;e.transform.rgb.g=e.transform.beginRGB.g;e.transform.rgb.b=e.transform.beginRGB.b}};q.prototype.setSpanValue=function(e){if(e){if(e instanceof n.ColorSpan){return e}else{return new n.ColorSpan(e)}}else{return null}};n.Color=q;n.Util.inherits(R,n.Behavior);R.prototype.reset=function(e,t,r,i){this.distanceVec=new n.Vector2D;this.centerPoint=n.Util.initValue(e,new n.Vector2D);this.force=n.Util.initValue(this.normalizeValue(t),100);if(r)R._super_.prototype.reset.call(this,r,i)};R.prototype.initialize=function(e){};R.prototype.applyBehavior=function(e,t,n){this.distanceVec.set(this.centerPoint.x-e.p.x,this.centerPoint.y-e.p.y);var r=this.distanceVec.lengthSq();if(r!=0){var i=this.distanceVec.length();var s=this.force*t/(r*i);e.v.x+=s*this.distanceVec.x;e.v.y+=s*this.distanceVec.y}};n.GravityWell=R;U.ID=0;n.Util.inherits(U,n.Particle);n.EventDispatcher.initialize(U.prototype);U.prototype.emit=function(e,t){this.emitTime=0;this.emitTotalTimes=n.Util.initValue(e,Infinity);if(t==true||t=="life"||t=="destroy"){if(e=="once")this.life=1;else this.life=this.emitTotalTimes}else if(!isNaN(t)){this.life=t}this.rate.init()};U.prototype.stopEmit=function(){this.emitTotalTimes=-1;this.emitTime=0};U.prototype.removeAllParticles=function(){for(var e=0;e<this.particles.length;e++)this.particles[e].dead=true};U.prototype.createParticle=function(e,t){var r=n.pool.get();this.setupParticle(r,e,t);this.dispatchEvent(new n.Event({type:n.PARTICLE_CREATED,particle:r}));return r};U.prototype.addSelfInitialize=function(e){if(e["init"]){e.init(this)}else{this.initAll()}};U.prototype.addInitialize=function(){var e=arguments.length,t;for(t=0;t<e;t++){this.initializes.push(arguments[t])}};U.prototype.removeInitialize=function(e){var t=this.initializes.indexOf(e);if(t>-1){this.initializes.splice(t,1)}};U.prototype.removeInitializers=function(){n.Util.destroyArray(this.initializes)};U.prototype.addBehavior=function(){var e=arguments.length,t;for(t=0;t<e;t++){this.behaviors.push(arguments[t]);if(arguments[t].hasOwnProperty("parents"))arguments[t].parents.push(this)}};U.prototype.removeBehavior=function(e){var t=this.behaviors.indexOf(e);if(t>-1)this.behaviors.splice(t,1)};U.prototype.removeAllBehaviors=function(){n.Util.destroyArray(this.behaviors)};U.prototype.integrate=function(e){var t=1-this.damping;n.integrator.integrate(this,e,t);var r=this.particles.length,i;for(i=0;i<r;i++){var s=this.particles[i];s.update(e,i);n.integrator.integrate(s,e,t);this.dispatchEvent(new n.Event({type:n.PARTICLE_UPDATE,particle:s}))}};U.prototype.emitting=function(e){if(this.emitTotalTimes=="once"){var t=this.rate.getValue(99999),n;for(n=0;n<t;n++){this.createParticle()}this.emitTotalTimes="none"}else if(!isNaN(this.emitTotalTimes)){this.emitTime+=e;if(this.emitTime<this.emitTotalTimes){var t=this.rate.getValue(e),n;for(n=0;n<t;n++){this.createParticle()}}}};U.prototype.update=function(e){this.age+=e;if(this.age>=this.life||this.dead){this.destroy()}this.emitting(e);this.integrate(e);var t;var r=this.particles.length,i;for(i=r-1;i>=0;i--){t=this.particles[i];if(t.dead){n.pool.set(t);this.particles.splice(i,1);this.dispatchEvent(new n.Event({type:n.PARTICLE_DEAD,particle:t}))}}};U.prototype.setupParticle=function(e,t,r){var i=this.initializes;var s=this.behaviors;if(t){if(t instanceof Array)i=t;else i=[t]}if(r){if(r instanceof Array)s=r;else s=[r]}n.InitializeUtil.initialize(this,e,i);e.addBehaviors(s);e.parent=this;this.particles.push(e)};U.prototype.destroy=function(){this.dead=true;this.emitTotalTimes=-1;if(this.particles.length==0){this.removeInitializers();this.removeAllBehaviors();if(this.parent)this.parent.removeEmitter(this)}};n.Emitter=U;n.Util.inherits(z,n.Emitter);z.prototype.addSelfBehavior=function(){var e=arguments.length,t;for(t=0;t<e;t++){this.selfBehaviors.push(arguments[t])}};z.prototype.removeSelfBehavior=function(e){var t=this.selfBehaviors.indexOf(e);if(t>-1)this.selfBehaviors.splice(t,1)};z.prototype.update=function(e){z._super_.prototype.update.call(this,e);if(!this.sleep){var t=this.selfBehaviors.length,n;for(n=0;n<t;n++){this.selfBehaviors[n].applyBehavior(this,e,n)}}};n.BehaviorEmitter=z;n.Util.inherits(W,n.Emitter);W.prototype.initEventHandler=function(){var e=this;this.mousemoveHandler=function(t){e.mousemove.call(e,t)};this.mousedownHandler=function(t){e.mousedown.call(e,t)};this.mouseupHandler=function(t){e.mouseup.call(e,t)};this.mouseTarget.addEventListener("mousemove",this.mousemoveHandler,false)};W.prototype.emit=function(){this._allowEmitting=true};W.prototype.stopEmit=function(){this._allowEmitting=false};W.prototype.mousemove=function(e){if(e.layerX||e.layerX==0){this.p.x+=(e.layerX-this.p.x)*this.ease;this.p.y+=(e.layerY-this.p.y)*this.ease}else if(e.offsetX||e.offsetX==0){this.p.x+=(e.offsetX-this.p.x)*this.ease;this.p.y+=(e.offsetY-this.p.y)*this.ease}if(this._allowEmitting)W._super_.prototype.emit.call(this,"once")};W.prototype.destroy=function(){W._super_.prototype.destroy.call(this);this.mouseTarget.removeEventListener("mousemove",this.mousemoveHandler,false)};n.FollowEmitter=W;var X=X||{easeLinear:function(e){return e},easeInQuad:function(e){return Math.pow(e,2)},easeOutQuad:function(e){return-(Math.pow(e-1,2)-1)},easeInOutQuad:function(e){if((e/=.5)<1)return.5*Math.pow(e,2);return-.5*((e-=2)*e-2)},easeInCubic:function(e){return Math.pow(e,3)},easeOutCubic:function(e){return Math.pow(e-1,3)+1},easeInOutCubic:function(e){if((e/=.5)<1)return.5*Math.pow(e,3);return.5*(Math.pow(e-2,3)+2)},easeInQuart:function(e){return Math.pow(e,4)},easeOutQuart:function(e){return-(Math.pow(e-1,4)-1)},easeInOutQuart:function(e){if((e/=.5)<1)return.5*Math.pow(e,4);return-.5*((e-=2)*Math.pow(e,3)-2)},easeInSine:function(e){return-Math.cos(e*(Math.PI/2))+1},easeOutSine:function(e){return Math.sin(e*(Math.PI/2))},easeInOutSine:function(e){return-.5*(Math.cos(Math.PI*e)-1)},easeInExpo:function(e){return e===0?0:Math.pow(2,10*(e-1))},easeOutExpo:function(e){return e===1?1:-Math.pow(2,-10*e)+1},easeInOutExpo:function(e){if(e===0)return 0;if(e===1)return 1;if((e/=.5)<1)return.5*Math.pow(2,10*(e-1));return.5*(-Math.pow(2,-10*--e)+2)},easeInCirc:function(e){return-(Math.sqrt(1-e*e)-1)},easeOutCirc:function(e){return Math.sqrt(1-Math.pow(e-1,2))},easeInOutCirc:function(e){if((e/=.5)<1)return-.5*(Math.sqrt(1-e*e)-1);return.5*(Math.sqrt(1-(e-=2)*e)+1)},easeInBack:function(e){var t=1.70158;return e*e*((t+1)*e-t)},easeOutBack:function(e){var t=1.70158;return(e=e-1)*e*((t+1)*e+t)+1},easeInOutBack:function(e){var t=1.70158;if((e/=.5)<1)return.5*e*e*(((t*=1.525)+1)*e-t);return.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},setEasingByName:function(e){switch(e){case"easeLinear":return n.ease.easeLinear;break;case"easeInQuad":return n.ease.easeInQuad;break;case"easeOutQuad":return n.ease.easeOutQuad;break;case"easeInOutQuad":return n.ease.easeInOutQuad;break;case"easeInCubic":return n.ease.easeInCubic;break;case"easeOutCubic":return n.ease.easeOutCubic;break;case"easeInOutCubic":return n.ease.easeInOutCubic;break;case"easeInQuart":return n.ease.easeInQuart;break;case"easeOutQuart":return n.ease.easeOutQuart;break;case"easeInOutQuart":return n.ease.easeInOutQuart;break;case"easeInSine":return n.ease.easeInSine;break;case"easeOutSine":return n.ease.easeOutSine;break;case"easeInOutSine":return n.ease.easeInOutSine;break;case"easeInExpo":return n.ease.easeInExpo;break;case"easeOutExpo":return n.ease.easeOutExpo;break;case"easeInOutExpo":return n.ease.easeInOutExpo;break;case"easeInCirc":return n.ease.easeInCirc;break;case"easeOutCirc":return n.ease.easeOutCirc;break;case"easeInOutCirc":return n.ease.easeInOutCirc;break;case"easeInBack":return n.ease.easeInBack;break;case"easeOutBack":return n.ease.easeOutBack;break;case"easeInOutBack":return n.ease.easeInOutBack;break;default:return n.ease.easeLinear;break}}};n.ease=X;n.easeLinear="easeLinear";n.easeInQuad="easeInQuad";n.easeOutQuad="easeOutQuad";n.easeInOutQuad="easeInOutQuad";n.easeInCubic="easeInCubic";n.easeOutCubic="easeOutCubic";n.easeInOutCubic="easeInOutCubic";n.easeInQuart="easeInQuart";n.easeOutQuart="easeOutQuart";n.easeInOutQuart="easeInOutQuart";n.easeInSine="easeInSine";n.easeOutSine="easeOutSine";n.easeInOutSine="easeInOutSine";n.easeInExpo="easeInExpo";n.easeOutExpo="easeOutExpo";n.easeInOutExpo="easeInOutExpo";n.easeInCirc="easeInCirc";n.easeOutCirc="easeOutCirc";n.easeInOutCirc="easeInOutCirc";n.easeInBack="easeInBack";n.easeOutBack="easeOutBack";n.easeInOutBack="easeInOutBack";V.prototype={start:function(){this.addEventHandler();this.renderer.start()},stop:function(){this.renderer.stop()},resize:function(e,t){this.renderer.resize(e,t)},setStroke:function(e,t){if(this.renderer.hasOwnProperty("stroke"))this.renderer.setStroke(e,t);else alert("Sorry this renderer do not suppest stroke method!")},createImageData:function(e){if(this.renderer instanceof n.PixelRender)this.renderer.createImageData(e)},setMaxRadius:function(e){if(this.renderer instanceof n.WebGLRender)this.renderer.setMaxRadius(e)},blendEquation:function(e){if(this.renderer instanceof n.WebGLRender)this.renderer.blendEquation(e)},blendFunc:function(e,t){if(this.renderer instanceof n.WebGLRender)this.renderer.blendFunc(e,t)},setType:function(e){this.type=e;this.renderer=this.getRenderer()},getRenderer:function(){switch(this.type){case"dom":return new n.DomRender(this.proton,this.element);break;case"canvas":return new n.CanvasRender(this.proton,this.element);break;case"webgl":return new n.WebGLRender(this.proton,this.element);break;case"easel":return new n.EaselRender(this.proton,this.element);break;case"easeljs":return new n.EaselRender(this.proton,this.element);break;case"pixel":return new n.PixelRender(this.proton,this.element);break;default:return new n.BaseRender(this.proton,this.element)}},render:function(e){this.renderer.render(e)},addEventHandler:function(){if(this.onProtonUpdate)this.renderer.onProtonUpdate=this.onProtonUpdate;if(this.onParticleCreated)this.renderer.onParticleCreated=this.onParticleCreated;if(this.onParticleUpdate)this.renderer.onParticleUpdate=this.onParticleUpdate;if(this.onParticleDead)this.renderer.onParticleDead=this.onParticleDead}};n.Renderer=V;$.prototype={start:function(){var e=this;this.proton.addEventListener(n.PROTON_UPDATE,function(t){e.onProtonUpdate.call(e)});this.proton.addEventListener(n.PROTON_UPDATE_AFTER,function(t){e.onProtonUpdateAfter.call(e)});this.proton.addEventListener(n.EMITTER_ADDED,function(t){e.onEmitterAdded.call(e,t.emitter)});this.proton.addEventListener(n.EMITTER_REMOVED,function(t){e.onEmitterRemoved.call(e,t.emitter)});var t=this.proton.emitters.length,r;for(r=0;r<t;r++){var i=this.proton.emitters[r];this.addEmitterListener(i)}},resize:function(e,t){},addEmitterListener:function(e){var t=this;e.addEventListener(n.PARTICLE_CREATED,function(e){t.onParticleCreated.call(t,e.particle)});e.addEventListener(n.PARTICLE_UPDATE,function(e){t.onParticleUpdate.call(t,e.particle)});e.addEventListener(n.PARTICLE_DEAD,function(e){t.onParticleDead.call(t,e.particle)})},stop:function(){var e=this.proton.emitters.length,t;this.proton.removeAllEventListeners();for(t=0;t<e;t++){var n=this.proton.emitters[t];n.removeAllEventListeners()}},onEmitterAdded:function(e){this.addEmitterListener(e)},onEmitterRemoved:function(e){e.removeAllEventListeners()},onProtonUpdate:function(){},onProtonUpdateAfter:function(){},onParticleCreated:function(e){},onParticleUpdate:function(e){},onParticleDead:function(e){}};n.BaseRender=$;n.Util.inherits(J,n.BaseRender);J.prototype.start=function(){J._super_.prototype.start.call(this)};J.prototype.setStroke=function(e,t){e=n.Util.initValue(e,"#000000");t=n.Util.initValue(t,1);this.stroke={color:e,thinkness:t}};J.prototype.onProtonUpdate=function(){};J.prototype.onParticleCreated=function(e){if(e.target){var t=this;n.Util.getImage(e.target,e,false,function(e){t.setImgInDIV.call(t,e)})}else{e.transform.canvas=n.DomUtil.createCanvas(e.id+"_canvas",e.radius+1,e.radius+1,"absolute");e.transform.bakOldRadius=e.radius;if(this.stroke){e.transform.canvas.width=2*e.radius+this.stroke.thinkness*2;e.transform.canvas.height=2*e.radius+this.stroke.thinkness*2}else{e.transform.canvas.width=2*e.radius+1;e.transform.canvas.height=2*e.radius+1}e.transform.context=e.transform.canvas.getContext("2d");e.transform.context.fillStyle=e.color;e.transform.context.beginPath();e.transform.context.arc(e.radius,e.radius,e.radius,0,Math.PI*2,true);if(this.stroke){e.transform.context.strokeStyle=this.stroke.color;e.transform.context.lineWidth=this.stroke.thinkness;e.transform.context.stroke()}e.transform.context.closePath();e.transform.context.fill();this.element.appendChild(e.transform.canvas)}};J.prototype.onParticleUpdate=function(e){if(e.target){if(e.target instanceof Image){e.transform.canvas.style.opacity=e.alpha;n.DomUtil.transformDom(e.transform.canvas,e.p.x-e.target.width/2,e.p.y-e.target.height/2,e.scale,e.rotation)}}else{e.transform.canvas.style.opacity=e.alpha;if(e.transform["oldRadius"])n.DomUtil.transformDom(e.transform.canvas,e.p.x-e.transform.oldRadius,e.p.y-e.transform.oldRadius,e.scale,e.rotation);else n.DomUtil.transformDom(e.transform.canvas,e.p.x-e.transform.bakOldRadius,e.p.y-e.transform.bakOldRadius,e.scale,e.rotation)}};J.prototype.onParticleDead=function(e){if(e.transform.canvas)this.element.removeChild(e.transform.canvas)};J.prototype.setImgInDIV=function(e){e.transform.canvas=n.DomUtil.createCanvas(e.id+"_canvas",e.target.width+1,e.target.height+1,"absolute",e.p.x-e.radius,e.p.y-e.radius);e.transform.context=e.transform.canvas.getContext("2d");e.transform.context.drawImage(e.target,0,0,e.target.width,e.target.height);this.element.appendChild(e.transform.canvas)};n.DomRender=J;n.Util.inherits(K,n.BaseRender);K.prototype.resize=function(e,t){};K.prototype.start=function(){K._super_.prototype.start.call(this)};K.prototype.onProtonUpdate=function(){};K.prototype.onParticleCreated=function(e){if(e.target){e.target=e.target.clone();if(!e.target.parent){if(!!e.target["image"]){e.target.regX=e.target.image.width/2;e.target.regY=e.target.image.height/2}this.element.addChild(e.target)}}else{var t=new createjs.Graphics;if(this.stroke){if(this.stroke==true){t.beginStroke("#000000")}else if(this.stroke instanceof String){t.beginStroke(this.stroke)}}t.beginFill(e.color).drawCircle(0,0,e.radius);var n=new createjs.Shape(t);e.target=n;this.element.addChild(e.target)}};K.prototype.onParticleUpdate=function(e){if(e.target){e.target.x=e.p.x;e.target.y=e.p.y;e.target.alpha=e.alpha;e.target.scaleX=e.target.scaleY=e.scale;e.target.rotation=e.rotation}};K.prototype.onParticleDead=function(e){if(e.target){if(e.target.parent)e.target.parent.removeChild(e.target)}};n.EaselRender=K;n.Util.inherits(Q,n.BaseRender);Q.prototype.resize=function(e,t){this.element.width=e;this.element.height=t};Q.prototype.start=function(){Q._super_.prototype.start.call(this)};Q.prototype.setStroke=function(e,t){e=n.Util.initValue(e,"#000000");t=n.Util.initValue(t,1);this.stroke={color:e,thinkness:t}};Q.prototype.onProtonUpdate=function(){this.context.clearRect(0,0,this.element.width,this.element.height)};Q.prototype.onParticleCreated=function(e){if(e.target)n.Util.getImage(e.target,e,false);else e.color=e.color?e.color:"#ff0000"};Q.prototype.onParticleUpdate=function(e){if(e.target){if(e.target instanceof Image){var t=e.target.width*e.scale|0;var r=e.target.height*e.scale|0;var i=e.p.x-t/2;var s=e.p.y-r/2;if(!!e.color){if(!e.transform["buffer"])e.transform.buffer=this.getBuffer(e.target);var o=e.transform.buffer.getContext("2d");o.clearRect(0,0,e.transform.buffer.width,e.transform.buffer.height);o.globalAlpha=e.alpha;o.drawImage(e.target,0,0);o.globalCompositeOperation="source-atop";o.fillStyle=n.Util.rgbToHex(e.transform.rgb);o.fillRect(0,0,e.transform.buffer.width,e.transform.buffer.height);o.globalCompositeOperation="source-over";o.globalAlpha=1;this.context.drawImage(e.transform.buffer,0,0,e.transform.buffer.width,e.transform.buffer.height,i,s,t,r)}else{this.context.save();this.context.globalAlpha=e.alpha;this.context.translate(e.p.x,e.p.y);this.context.rotate(n.MathUtils.degreeTransform(e.rotation));this.context.translate(-e.p.x,-e.p.y);this.context.drawImage(e.target,0,0,e.target.width,e.target.height,i,s,t,r);this.context.globalAlpha=1;this.context.restore()}}}else{if(e.transform["rgb"])this.context.fillStyle="rgba("+e.transform.rgb.r+","+e.transform.rgb.g+","+e.transform.rgb.b+","+e.alpha+")";else this.context.fillStyle=e.color;this.context.beginPath();this.context.arc(e.p.x,e.p.y,e.radius,0,Math.PI*2,true);if(this.stroke){this.context.strokeStyle=this.stroke.color;this.context.lineWidth=this.stroke.thinkness;this.context.stroke()}this.context.closePath();this.context.fill()}};Q.prototype.onParticleDead=function(e){};Q.prototype.getBuffer=function(e){if(e instanceof Image){var t=e.width+"_"+e.height;var n=this.bufferCache[t];if(!n){n=document.createElement("canvas");n.width=e.width;n.height=e.height;this.bufferCache[t]=n}return n}};n.CanvasRender=Q;n.Util.inherits(G,n.BaseRender);G.prototype.resize=function(e,t){this.element.width=e;this.element.height=t};G.prototype.createImageData=function(e){if(!e)this.rectangle=new n.Rectangle(0,0,this.element.width,this.element.height);else this.rectangle=e;this.imageData=this.context.createImageData(this.rectangle.width,this.rectangle.height);this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)};G.prototype.start=function(){G._super_.prototype.start.call(this)};G.prototype.onProtonUpdate=function(){this.context.clearRect(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height);this.imageData=this.context.getImageData(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height)};G.prototype.onProtonUpdateAfter=function(){this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)};G.prototype.onParticleCreated=function(e){};G.prototype.onParticleUpdate=function(e){if(this.imageData){this.setPixel(this.imageData,Math.floor(e.p.x-this.rectangle.x),Math.floor(e.p.y-this.rectangle.y),e)}};G.prototype.setPixel=function(e,t,n,r){var i=r.transform.rgb;if(t<0||t>this.element.width||n<0||n>this.elementwidth)return;var s=((n>>0)*e.width+(t>>0))*4;e.data[s]=i.r;e.data[s+1]=i.g;e.data[s+2]=i.b;e.data[s+3]=r.alpha*255};G.prototype.onParticleDead=function(e){};n.PixelRender=G;n.Util.inherits(Y,n.BaseRender);Y.prototype.resize=function(e,t){this.umat[4]=-2;this.umat[7]=1;this.smat[0]=1/e;this.smat[4]=1/t;this.mstack.set(this.umat,0);this.mstack.set(this.smat,1);this.gl.viewport(0,0,e,t);this.element.width=e;this.element.height=t};Y.prototype.setMaxRadius=function(e){this.circleCanvasURL=this.createCircle(e)};Y.prototype.getVertexShader=function(){var e=["uniform vec2 viewport;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 tMat;","varying vec2 vTextureCoord;","varying float alpha;","void main() {","vec3 v = tMat * vec3(aVertexPosition, 1.0);","gl_Position = vec4(v.x, v.y, 0, 1);","vTextureCoord = aTextureCoord;","alpha = tMat[0][2];","}"].join("\n");return e};Y.prototype.getFragmentShader=function(){var e=["precision mediump float;","varying vec2 vTextureCoord;","varying float alpha;","uniform sampler2D uSampler;","uniform vec4 color;","uniform bool useTexture;","uniform vec3 uColor;","void main() {","vec4 textureColor = texture2D(uSampler, vTextureCoord);","gl_FragColor = textureColor * vec4(uColor, 1.0);","gl_FragColor.w *= alpha;","}"].join("\n");return e};Y.prototype.initVar=function(){this.mstack=new n.MStack;this.umat=n.Mat3.create([2,0,1,0,-2,0,-1,1,1]);this.smat=n.Mat3.create([1/100,0,1,0,1/100,0,0,0,1]);this.texturebuffers={}};Y.prototype.start=function(){Y._super_.prototype.start.call(this);this.resize(this.element.width,this.element.height)};Y.prototype.blendEquation=function(e){this.gl.blendEquation(this.gl[e])};Y.prototype.blendFunc=function(e,t){this.gl.blendFunc(this.gl[e],this.gl[t])};Y.prototype.getShader=function(e,t,n){var r;if(n)r=e.createShader(e.FRAGMENT_SHADER);else r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,t);e.compileShader(r);if(!e.getShaderParameter(r,e.COMPILE_STATUS)){alert(e.getShaderInfoLog(r));return null}return r};Y.prototype.initShaders=function(){var e=this.getShader(this.gl,this.getFragmentShader(),true);var t=this.getShader(this.gl,this.getVertexShader(),false);this.sprogram=this.gl.createProgram();this.gl.attachShader(this.sprogram,t);this.gl.attachShader(this.sprogram,e);this.gl.linkProgram(this.sprogram);if(!this.gl.getProgramParameter(this.sprogram,this.gl.LINK_STATUS))alert("Could not initialise shaders");this.gl.useProgram(this.sprogram);this.sprogram.vpa=this.gl.getAttribLocation(this.sprogram,"aVertexPosition");this.sprogram.tca=this.gl.getAttribLocation(this.sprogram,"aTextureCoord");this.gl.enableVertexAttribArray(this.sprogram.tca);this.gl.enableVertexAttribArray(this.sprogram.vpa);this.sprogram.tMatUniform=this.gl.getUniformLocation(this.sprogram,"tMat");this.sprogram.samplerUniform=this.gl.getUniformLocation(this.sprogram,"uSampler");this.sprogram.useTex=this.gl.getUniformLocation(this.sprogram,"useTexture");this.sprogram.color=this.gl.getUniformLocation(this.sprogram,"uColor");this.gl.uniform1i(this.sprogram.useTex,1)};Y.prototype.initBuffers=function(){this.unitIBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer);var e=[0,3,1,0,2,3];this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),this.gl.STATIC_DRAW);var t=[];for(var n=0;n<100;n++)t.push(n);idx=new Uint16Array(t);this.unitI33=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitI33);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW);t=[];for(n=0;n<100;n++)t.push(n,n+1,n+2);idx=new Uint16Array(t);this.stripBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.stripBuffer);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW)};Y.prototype.createCircle=function(e){this.circleCanvasRadius=n.WebGLUtil.nhpot(n.Util.initValue(e,32));var t=n.DomUtil.createCanvas("circle_canvas",this.circleCanvasRadius*2,this.circleCanvasRadius*2);var r=t.getContext("2d");r.beginPath();r.arc(this.circleCanvasRadius,this.circleCanvasRadius,this.circleCanvasRadius,0,Math.PI*2,true);r.closePath();r.fillStyle="#FFF";r.fill();return t.toDataURL()};Y.prototype.setImgInCanvas=function(e){var t=e.target.width;var r=e.target.height;var i=n.WebGLUtil.nhpot(e.target.width);var s=n.WebGLUtil.nhpot(e.target.height);var o=e.target.width/i;var u=e.target.height/s;if(!this.texturebuffers[e.transform.src])this.texturebuffers[e.transform.src]=[this.gl.createTexture(),this.gl.createBuffer(),this.gl.createBuffer()];e.transform.texture=this.texturebuffers[e.transform.src][0];e.transform.vcBuffer=this.texturebuffers[e.transform.src][1];e.transform.tcBuffer=this.texturebuffers[e.transform.src][2];this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.transform.tcBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,o,0,0,u,u,u]),this.gl.STATIC_DRAW);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.transform.vcBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,t,0,0,r,t,r]),this.gl.STATIC_DRAW);var a=e.transform.canvas.getContext("2d");var f=a.getImageData(0,0,i,s);this.gl.bindTexture(this.gl.TEXTURE_2D,e.transform.texture);this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,f);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_NEAREST);this.gl.generateMipmap(this.gl.TEXTURE_2D);e.transform.textureLoaded=true;e.transform.textureWidth=t;e.transform.textureHeight=r};Y.prototype.setStroke=function(e,t){};Y.prototype.onProtonUpdate=function(){};Y.prototype.onParticleCreated=function(e){var t=this;e.transform.textureLoaded=false;e.transform.tmat=n.Mat3.create();e.transform.tmat[8]=1;e.transform.imat=n.Mat3.create();e.transform.imat[8]=1;if(e.target){n.Util.getImage(e.target,e,true,function(e){t.setImgInCanvas.call(t,e);e.transform.oldScale=1})}else{n.Util.getImage(this.circleCanvasURL,e,true,function(e){t.setImgInCanvas.call(t,e);e.transform.oldScale=e.radius/t.circleCanvasRadius})}};Y.prototype.onParticleUpdate=function(e){if(e.transform.textureLoaded){this.updateMatrix(e);this.gl.uniform3f(this.sprogram.color,e.transform.rgb.r/255,e.transform.rgb.g/255,e.transform.rgb.b/255);this.gl.uniformMatrix3fv(this.sprogram.tMatUniform,false,this.mstack.top());this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.transform.vcBuffer);this.gl.vertexAttribPointer(this.sprogram.vpa,2,this.gl.FLOAT,false,0,0);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.transform.tcBuffer);this.gl.vertexAttribPointer(this.sprogram.tca,2,this.gl.FLOAT,false,0,0);this.gl.bindTexture(this.gl.TEXTURE_2D,e.transform.texture);this.gl.uniform1i(this.sprogram.samplerUniform,0);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer);this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0);this.mstack.pop()}};Y.prototype.onParticleDead=function(e){};Y.prototype.updateMatrix=function(e){var t=n.WebGLUtil.makeTranslation(-e.transform.textureWidth/2,-e.transform.textureHeight/2);var r=n.WebGLUtil.makeTranslation(e.p.x,e.p.y);var i=e.rotation*(Math.PI/180);var s=n.WebGLUtil.makeRotation(i);var o=e.scale*e.transform.oldScale;var u=n.WebGLUtil.makeScale(o,o);var a=n.WebGLUtil.matrixMultiply(t,u);a=n.WebGLUtil.matrixMultiply(a,s);a=n.WebGLUtil.matrixMultiply(a,r);n.Mat3.inverse(a,e.transform.imat);a[2]=e.alpha;this.mstack.push(a)};n.WebGLRender=Y;Z.prototype={getPosition:function(){},crossing:function(e){}};n.Zone=Z;n.Util.inherits(et,n.Zone);et.prototype.getPosition=function(){this.random=Math.random();this.vector.x=this.x1+this.random*this.length*Math.cos(this.gradient);this.vector.y=this.y1+this.random*this.length*Math.sin(this.gradient);return this.vector};et.prototype.getDirection=function(e,t){var n=this.dy;var r=-this.dx;var i=this.dot;var s=r==0?1:r;if((n*e+r*t+i)*s>0)return true;else return false};et.prototype.getDistance=function(e,t){var n=this.dy;var r=-this.dx;var i=this.dot;var s=n*e+r*t+i;return s/Math.sqrt(this.xxyy)};et.prototype.getSymmetric=function(e){var t=e.getGradient();var n=this.getGradient();var r=2*(n-t);var i=e.x;var s=e.y;e.x=i*Math.cos(r)-s*Math.sin(r);e.y=i*Math.sin(r)+s*Math.cos(r);return e};et.prototype.getGradient=function(){return Math.atan2(this.dy,this.dx)};et.prototype.getRange=function(e,t){var n=Math.abs(this.getGradient());if(n<=Math.PI/4){if(e.p.x<this.maxx&&e.p.x>this.minx){t()}}else{if(e.p.y<this.maxy&&e.p.y>this.miny){t()}}};et.prototype.getLength=function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)};et.prototype.crossing=function(e){var t=this;if(this.crossType=="dead"){if(this.direction==">"||this.direction=="R"||this.direction=="right"||this.direction=="down"){this.getRange(e,function(){if(t.getDirection(e.p.x,e.p.y))e.dead=true})}else{this.getRange(e,function(){if(!t.getDirection(e.p.x,e.p.y))e.dead=true})}}else if(this.crossType=="bound"){this.getRange(e,function(){if(t.getDistance(e.p.x,e.p.y)<=e.radius){if(t.dx==0){e.v.x*=-1}else if(t.dy==0){e.v.y*=-1}else{t.getSymmetric(e.v)}}})}else if(this.crossType=="cross"){if(this.alert){alert("Sorry lineZone does not support cross method");this.alert=false}}};n.LineZone=et;n.Util.inherits(tt,n.Zone);tt.prototype.getPosition=function(){this.random=Math.random();this.angle=Math.PI*2*Math.random();this.vector.x=this.x+this.random*this.radius*Math.cos(this.angle);this.vector.y=this.y+this.random*this.radius*Math.sin(this.angle);return this.vector};tt.prototype.setCenter=function(e,t){this.center.x=e;this.center.y=t};tt.prototype.crossing=function(e){var t=e.p.distanceTo(this.center);if(this.crossType=="dead"){if(t-e.radius>this.radius)e.dead=true}else if(this.crossType=="bound"){if(t+e.radius>=this.radius)this.getSymmetric(e)}else if(this.crossType=="cross"){if(this.alert){alert("Sorry CircleZone does not support cross method");this.alert=false}}};tt.prototype.getSymmetric=function(e){var t=e.v.getGradient();var n=this.getGradient(e);var r=2*(n-t);var i=e.v.x;var s=e.v.y;e.v.x=i*Math.cos(r)-s*Math.sin(r);e.v.y=i*Math.sin(r)+s*Math.cos(r)};tt.prototype.getGradient=function(e){return-Math.PI/2+Math.atan2(e.p.y-this.center.y,e.p.x-this.center.x)};n.CircleZone=tt;n.Util.inherits(nt,n.Zone);nt.prototype.getPosition=function(){this.vector.x=this.x;this.vector.y=this.y;return this.vector};nt.prototype.crossing=function(e){if(this.alert){alert("Sorry PointZone does not support crossing method");this.alert=false}};n.PointZone=nt;n.Util.inherits(rt,n.Zone);rt.prototype.getPosition=function(){this.vector.x=this.x+Math.random()*this.width;this.vector.y=this.y+Math.random()*this.height;return this.vector};rt.prototype.crossing=function(e){if(this.crossType=="dead"){if(e.p.x+e.radius<this.x)e.dead=true;else if(e.p.x-e.radius>this.x+this.width)e.dead=true;if(e.p.y+e.radius<this.y)e.dead=true;else if(e.p.y-e.radius>this.y+this.height)e.dead=true}else if(this.crossType=="bound"){if(e.p.x-e.radius<this.x){e.p.x=this.x+e.radius;e.v.x*=-1}else if(e.p.x+e.radius>this.x+this.width){e.p.x=this.x+this.width-e.radius;e.v.x*=-1}if(e.p.y-e.radius<this.y){e.p.y=this.y+e.radius;e.v.y*=-1}else if(e.p.y+e.radius>this.y+this.height){e.p.y=this.y+this.height-e.radius;e.v.y*=-1}}else if(this.crossType=="cross"){if(e.p.x+e.radius<this.x&&e.v.x<=0)e.p.x=this.x+this.width+e.radius;else if(e.p.x-e.radius>this.x+this.width&&e.v.x>=0)e.p.x=this.x-e.radius;if(e.p.y+e.radius<this.y&&e.v.y<=0)e.p.y=this.y+this.height+e.radius;else if(e.p.y-e.radius>this.y+this.height&&e.v.y>=0)e.p.y=this.y-e.radius}};n.RectZone=rt;n.Util.inherits(it,n.Zone);it.prototype.reset=function(e,t,r,i){this.imageData=e;this.x=n.Util.initValue(t,0);this.y=n.Util.initValue(r,0);this.d=n.Util.initValue(i,2);this.vectors=[];this.setVectors()};it.prototype.setVectors=function(){var e,t;var n=this.imageData.width;var r=this.imageData.height;for(e=0;e<n;e+=this.d){for(t=0;t<r;t+=this.d){var i=((t>>0)*n+(e>>0))*4;if(this.imageData.data[i+3]>0){this.vectors.push({x:e+this.x,y:t+this.y})}}}return this.vector};it.prototype.getBound=function(e,t){var n=((t>>0)*this.imageData.width+(e>>0))*4;if(this.imageData.data[n+3]>0)return true;else return false};it.prototype.getPosition=function(){return this.vector.copy(this.vectors[Math.floor(Math.random()*this.vectors.length)])};it.prototype.getColor=function(e,t){e-=this.x;t-=this.y;var n=((t>>0)*this.imageData.width+(e>>0))*4;return{r:this.imageData.data[n],g:this.imageData.data[n+1],b:this.imageData.data[n+2],a:this.imageData.data[n+3]}};it.prototype.crossing=function(e){if(this.crossType=="dead"){if(this.getBound(e.p.x-this.x,e.p.y-this.y))e.dead=true;else e.dead=false}else if(this.crossType=="bound"){if(!this.getBound(e.p.x-this.x,e.p.y-this.y))e.v.negate()}};n.ImageZone=it;var st=function(){if(e.console&&e.console.log){var t=arguments;if(typeof arguments[0]=="string"){if(arguments[0].indexOf("+")==0){var n=parseInt(arguments[0]);if(st.once<n){delete t[0];console.log(t);st.once++}}else{console.log(t)}}else{console.log(t)}}};st.once=0;n.log=st;var ot=ot||{addEventListener:function(e,t){e.addEventListener(n.PROTON_UPDATE,function(e){t()})},setStyle:function(e){var t=e||"#ff0000";var r=n.Util.hexToRGB(t);var i="rgba("+r.r+","+r.g+","+r.b+","+.5+")";return i},drawZone:function(e,t,r,i){var s=t.getContext("2d");var o=this.setStyle();this.addEventListener(e,function(){if(i)s.clearRect(0,0,t.width,t.height);if(r instanceof n.PointZone){s.beginPath();s.fillStyle=o;s.arc(r.x,r.y,10,0,Math.PI*2,true);s.fill();s.closePath()}else if(r instanceof n.LineZone){s.beginPath();s.strokeStyle=o;s.moveTo(r.x1,r.y1);s.lineTo(r.x2,r.y2);s.stroke();s.closePath()}else if(r instanceof n.RectZone){s.beginPath();s.strokeStyle=o;s.drawRect(r.x,r.y,r.width,r.height);s.stroke();s.closePath()}else if(r instanceof n.CircleZone){s.beginPath();s.strokeStyle=o;s.arc(r.x,r.y,r.radius,0,Math.PI*2,true);s.stroke();s.closePath()}})},drawEmitter:function(e,t,n,r){var i=t.getContext("2d");var s=this.setStyle();this.addEventListener(e,function(){if(r)i.clearRect(0,0,t.width,t.height);i.beginPath();i.fillStyle=s;i.arc(n.p.x,n.p.y,10,0,Math.PI*2,true);i.fill();i.closePath()})},test:{},setTest:function(e,t){this.test[e]=t},getTest:function(e){if(this.test.hasOwnProperty(e))return this.test[e];else return false}};n.Debug=ot}(window);!function(){var e=0;var t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(t,n){var r=(new Date).getTime();var i=Math.max(0,16-(r-e));var s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(e){clearTimeout(e)}}()
